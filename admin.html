<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gestão de Usuários</title>

    <!-- Bulma CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <!-- Optional icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script>
      const usuario = JSON.parse(localStorage.getItem("usuario"));
      if (!usuario) {
        window.location.href = "index";
      }
    </script>

    <style>
      /* Pequenos ajustes para aproximar a aparência original */
      .avatar-circle { width:48px; height:48px; border-radius:50%; display:inline-flex; align-items:center; justify-content:center; color:#fff; font-weight:700; }
      .table-container { overflow-x:auto; }
      .search-input { padding-left:2.5rem; }
      .search-icon { position:relative; left:8px; top:10px; color:#a0a0a0; }
      /* Avatar dropdown customization */
      .avatar-dropdown { min-width:220px; }
    </style>
  </head>

  <body>
    <section class="section">
      <div class="container">
        <div class="box">
          <!-- Header -->
          <header class="level">
            <div class="level-left">
              <div class="level-item">
                <h1 class="title is-4">Gerencie os usuários do sistema</h1>
              </div>
            </div>

            <div class="level-right">
              <div class="level-item">
                <!-- Avatar com dropdown -->
                <div class="dropdown is-right" id="avatarDropdown">
                  <div class="dropdown-trigger">
                    <button class="button is-white" aria-haspopup="true" aria-controls="dropdown-menu" id="avatarBtn">
                      <span class="avatar-circle has-background-primary" id="avatarInicial">U</span>
                    </button>
                  </div>
                  <div class="dropdown-menu avatar-dropdown" id="dropdown-menu" role="menu">
                    <div class="dropdown-content p-3">
                      <p><strong>ID:</strong> <span id="avatarId"></span></p>
                      <p><strong>Nome:</strong> <span id="avatarNome"></span></p>
                      <p><strong>Telefone:</strong> <span id="avatarTelefone"></span></p>
                      <p><strong>Status:</strong> <span id="avatarStatus"></span></p>
                      <hr>
                      <div class="buttons">
                        <button id="avatarLogoutBtn" class="button is-danger is-small">Sair</button>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- /Avatar -->
              </div>
            </div>
          </header>

          <!-- Tabs -->
          <div class="tabs is-boxed">
            <ul>
              <li class="is-active" id="usersTabBtn"><a>Usuários</a></li>
              <li id="addUserTabBtn"><a>Adicionar Usuário</a></li>
            </ul>
          </div>

          <!-- Content card -->
          <div class="content">
            <!-- Users Tab -->
            <div id="usersTab">
              <div class="level mb-3">
                <div class="level-left">
                  <div class="level-item">
                    <h2 class="subtitle is-5">Lista de Usuários</h2>
                  </div>
                </div>
                <div class="level-right">
                  <div class="level-item">
                    <div class="field has-addons">
                      <div class="control has-icons-left">
                        <input class="input search-input" type="text" id="searchInput" placeholder="Buscar usuário...">
                        <span class="icon is-small is-left search-icon"><i class="fas fa-search"></i></span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="table-container">
                <table class="table is-fullwidth is-striped is-hoverable">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Nome</th>
                      <th>Telefone</th>
                      <th>Status</th>
                      <th class="has-text-centered">Ações</th>
                    </tr>
                  </thead>
                  <tbody id="usersTableBody">
                    <!-- Skeleton -->
                    <tr>
                      <td colspan="5" class="has-text-centered">
                        <progress class="progress is-small is-primary" max="100">Carregando</progress>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Add User Tab -->
            <div id="addUserTab" style="display:none;">
              <h2 class="subtitle is-5">Adicionar Novo Usuário</h2>

              <form id="addUserForm">
                <div class="field">
                  <label class="label">Nome</label>
                  <div class="control">
                    <input class="input" type="text" id="name" name="name" required>
                  </div>
                </div>

                <div class="field">
                  <label class="label">Telefone</label>
                  <div class="control">
                    <input class="input" type="text" id="phone" name="phone" required>
                  </div>
                </div>

                <div class="field">
                  <label class="label">Senha</label>
                  <div class="control">
                    <input class="input" type="password" id="password" name="password" required>
                  </div>
                </div>

                <div class="field is-grouped is-grouped-right">
                  <p class="control">
                    <button type="button" id="cancelAddUserBtn" class="button is-light">Cancelar</button>
                  </p>
                  <p class="control">
                    <button type="submit" class="button is-primary">Salvar Usuário</button>
                  </p>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Edit User Modal (Bulma) -->
    <div class="modal" id="editUserModal">
      <div class="modal-background"></div>
      <div class="modal-card">
        <header class="modal-card-head">
          <p class="modal-card-title">Editar Usuário</p>
          <button class="delete" aria-label="close" id="closeEditModalBtn"></button>
        </header>
        <section class="modal-card-body">
          <form id="editUserForm">
            <input type="hidden" id="editUserId">

            <div class="field">
              <label class="label">Nome</label>
              <div class="control">
                <input class="input" type="text" id="editName" name="editName" required>
              </div>
            </div>

            <div class="field">
              <label class="label">Telefone</label>
              <div class="control">
                <input class="input" type="text" id="editPhone" name="editPhone" required>
              </div>
            </div>

            <div class="field">
              <label class="label">Status</label>
              <div class="control">
                <div class="select is-fullwidth">
                  <select id="editStatus" name="editStatus">
                    <option value="1">Ativo</option>
                    <option value="0">Inativo</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="field">
              <label class="label">Nova Senha (opcional)</label>
              <div class="control">
                <input class="input" type="password" id="editPassword" name="editPassword" placeholder="Deixe em branco para manter a senha atual">
              </div>
            </div>

          </form>
        </section>
        <footer class="modal-card-foot is-justify-content-flex-end">
          <button class="button" id="cancelEditBtn">Cancelar</button>
          <button class="button is-primary" id="saveEditBtn">Salvar Alterações</button>
        </footer>
      </div>
    </div>

    <!-- Scripts: integrando comportamentos simples para alternar tabs e modal (você pode manter seu index.js) -->
    <script>
      // Tab switching
      const usersTabBtn = document.getElementById('usersTabBtn');
      const addUserTabBtn = document.getElementById('addUserTabBtn');
      const usersTab = document.getElementById('usersTab');
      const addUserTab = document.getElementById('addUserTab');

      usersTabBtn.addEventListener('click', () => {
        usersTabBtn.classList.add('is-active');
        addUserTabBtn.classList.remove('is-active');
        usersTab.style.display = '';
        addUserTab.style.display = 'none';
      });

      addUserTabBtn.addEventListener('click', () => {
        addUserTabBtn.classList.add('is-active');
        usersTabBtn.classList.remove('is-active');
        usersTab.style.display = 'none';
        addUserTab.style.display = '';
      });

      // Avatar dropdown toggle
      const avatarDropdown = document.getElementById('avatarDropdown');
      const avatarBtn = document.getElementById('avatarBtn');
      avatarBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        avatarDropdown.classList.toggle('is-active');
      });
      document.addEventListener('click', () => avatarDropdown.classList.remove('is-active'));

      // Modal controls
      const editUserModal = document.getElementById('editUserModal');
      const closeEditModalBtn = document.getElementById('closeEditModalBtn');
      const cancelEditBtn = document.getElementById('cancelEditBtn');
      const saveEditBtn = document.getElementById('saveEditBtn');

      function openEditModal() { editUserModal.classList.add('is-active'); }
      function closeEditModal() { editUserModal.classList.remove('is-active'); }

      closeEditModalBtn.addEventListener('click', closeEditModal);
      cancelEditBtn.addEventListener('click', closeEditModal);
      // saveEditBtn can trigger form submission or your existing save logic

      // Delegation example: abrir modal ao clicar em um botão editar (você deve adaptar ao seu JS)
      document.addEventListener('click', (e) => {
        if (e.target.matches('.btn-edit') || e.target.closest('.btn-edit')) {
          // preencher campos do modal aqui com dados do usuário
          openEditModal();
        }
      });
    </script>

    <script src="./config/js/index.js"></script>
  </body>
</html>
